---
sidebar_position: 7
title: API specs
---

## Getting Started

### Importing CRUD module to your project

Make sure that you have appropriate [model specifications](../model-setup) in your project. The CLI will guide the user for the project specific CRUD setup.

#### Importing your project in a microservice

When you start Godspeed microservice with your project, it will [autogenerate the REST, Socket and Message bus endpoints]<!-- (../out-of-box/auto-export.md)--> for the functions exported by your project. You can customize your exports in `config/global-exports.yaml` file. -->

- It will export the CRUD functions
- It will also export any other functions you have in your project structure.

### Universal CRUD API

- The query interface of these functions is generic, and vendor independent. Yet, there are ways to run SQL and native queries on every vendor.

```
  //SQL query to Postgres
  godspeed.find({
    _sql_query: “select * from….”,
    source: “postgres” //Can be any configured database which supports SQL
  })

  //Mongodb query
  godspeed.findOrCreate({
    _type: “article”, //Godspeed uses the terminology _type for entity type. It translates to collection/index/table names automatically in its pluralized form.
    _native_query : { tags: ["technology", "low-code"] },
    source: “mongodb”
  })

```

> All of the functions below can be run in any combination as a function DAG.

## CRUD API available functions

---

### Create

Saves the entity in the target database.

#### Params

```
  _type: String //One of the types from the model
  _id: String | Number //Optional. If not given, a UUID is autogenerated.
  body: Object //A body as per the defined fields of the entity. This will be validated against the respective model
```

**Example request**

```
{
  '_type': 'borrower_profile',
  'body': {
    'english': {
      'name': 'Deepti'
    },
    'hindi': {
      'name': 'दीप्ति'
    },
    pan: 'AKJPG810**',
    pincode: 176057,
    product: { //While creating an entity, it can also be linked to an existing entity, by their valid relationship
      _id: 5 //Link to the product with id 5
    }
  }
}
```

#### Response

##### On Success

```
  _id: id as specified in the request
  _type: type of the entity as sent in the request
  status: status code as per the standards
  message: Explanatory message
```

##### On failure

```
  //A GSError object
  status: status code, extending the standards
  message: Error message
  stack: Error stack
  errors: [GSError]
```

---

### Update

#### Params

```
_id: id of the entity field needs to be updated
_type: the type of the entity
update: the update instructions
```

> Update instructions follow the API specified [here](https://www.npmjs.com/package/js-object-updater)

**Example update instructions**

```
{
  _id: 'AVeawbnNW2vhiwtp9F2D',
  _type: 'event',
  update: {
    set: {
      title: 'Finding Common Ground',
      x: [1, 2],
      yString: ['Music']
    },
    push: {
      x: 567,
      yString: ['for', 'life']
    },
    addToSet: {
      x: [567],
      yString: ['for']
    },
    unset: [
      'y'
    ]
  }
}

```

#### Response

##### On Success

```
  status: 201
  message: Successfully updated
  data:
    _id: id as specified in the request
    _type: type of the entity updated
```

##### On failure

```
  //A GSError object
  status: status code, extending the standards
  stack: Error stack
  message: Error message
  errors: [GSError]
```

---

### Delete

Deletes are cascading. Deleting an entity also removes its references (and any denormalized data) in other entities to which the entity is liked.

#### Params

```
_id: id of the entity field needs to be updated
_type: the type of the entity
```

#### Response

##### On Success

```
  status: 204
  message: Deleted successfully
  data:
     _id: id as specified in the request
    _type: type of the entity as sent in the request
```

##### On failure

```
  //A GSError object
  status: status code, extending the standards
  stack: Error stack
  message: Error message
  errors: [GSError]
```

---

### Get by Id

One can retrieve an entity of a given type by its \_id.

```
// Fetch borrower profile with selected fields and also some fields(GMV) from its relationship

{
  _type: 'borrower_profile',
  _id: 'AVeuJeQ9jGz7t7QfUg_M',
  langs: ['hindi']
  returnData: {
    name: 1, //multi lingual field in DB model spec
    mid: 1,
    linkedProduct: {
      name: 1
    }
  }
}

// Returns
{
    "message": "Successfully read borrower_profile",
    "status": 200,
    "data": {
        "_type": "borrower_profile",
        "_id": "AVeuJeQ9jGz7t7QfUg_M",
        "data": {
           'hindi': {
              'name': 'दीप्ति'
            },
            'mid': '87asdf87',
            'linkedProduct': {
              '_id': 5,
              '_type': 'product'
              'data': {
                'name': "Existence"
              }
            }
        }
    }
}
```

#### Params

```
_type: type of the entity
_id: id of the entity
returnData: The data to return including the entity's own properties and those of its related entities.
langs: Optional. The retrieved data is to be brought only for these languages. Other language data will not be retrieved. By default, all language data is retrieved.
```

#### Response

##### On Success

```
  status: 200
  data: the data including the id, type and the requested returnData
  message: Successfully retrieved
```

##### On failure

```
  //A GSError object
  status: status code, extending the standards
  stack: Error stack
  message: Error message
  errors: [GSError]
```

---

### Find

Find entities matching specified criteria with pagination.

```
// Fetch borrower profile with selected fields and also some fields(GMV) from its relationship

{
  _type: 'borrower_profile',
  query: {
    name: 'दीप्ति'
  },
  langs: ['hindi'],
  returnData: {
    name: 1, //multi lingual field in DB model spec
    mid: 1,
    linkedProduct: {
      name: 1
    }
  }
}

// Returns
{
    "message": "Successfully read borrower_profile",
    "status": 200,
    "data": {
      "count" : 11,
      "data": [
          {
            "_type": "borrower_profile",
            "_id": "AVeuJeQ9jGz7t7QfUg_M",
            "data": {
              'hindi': {
                  'name': 'दीप्ति'
                },
                'mid': '87asdf87',
                'linkedProduct': {
                  '_id': 5,
                  '_type': 'product'
                  'data': {
                    'name': "Existence"
                  }
                }
            }
        }
      ]
    },

}
```

#### Params

```
  _type: A single entity type or multiple types in an array
  returnData: The data to return (same as get by id above)
  query: The matching criteria in GS syntax
  _sql_query: The matching criteria in SQL format
  _native_query: The matching criteria in native DB format
  size: The number of matching results wanted
  offset: The offset for pagination
  langs: The languages in which data is to be retrieved
```

> Note: among the query, \_sql_query, \_native_query clauses, only one of them must be present, else an error is raised

#### Response

##### On Success

```
  status: 200
  data: matched entities with their respective id, type and returnData
  message: Successfully retrieved
```

##### On failure

```
  //A GSError object
  status: status code, extending the standards
  message: Telling what happened
  errors: List of GSError objects explaining errors in details
```

---

### Search

It is an extension of 'find' with where clause including additional text search capabilities like match_phrase and autosuggest. Currently works with Elasticsearch backend.

#### Request

```
  _type: A single entity type or multiple types in an array
  returnData: The data to return (same as get by id)
  query: The matching criteria in GS syntax
  _native_query: Elasticsearch API
  _sql_query: Elasticsearch supported SQL syntax
  size: The number of matching results wanted
  offset: The offset for pagination
  langs: The languages in which data is to be retrieved

```

#### Response

##### On Success

```
  _id: id as specified in the request
  _type: type of the entity as sent in the request
  status: status code as per the standards
```

##### On failure

```
  //A GSError object
  status: status code, extending the standards
  message: Telling what happened
  errors: List of GSError objects explaining errors in details
```
